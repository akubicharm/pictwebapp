# Azure IoT Edge にデプロイする場合

このモジュールは、80番ポートで http のリクエストを受付、受信したファイルを指定したホストパスに保存します。

以下は、次の設定をする手順です。

* ホストパスの `/work/data` をコンテナの `hostvolume` からマウントするための設定
* コンテナの80番ポートをホストの80番ポートにマッピングして公開するための設定


## IoT Edgeの設定

IoT Edgeの実行環境の設定済みの環境に、写真アップロード用のWebアプリケーションをデプロイします。

### コンテナイメージの準備

Dockerのコンテナイメージを作成し、パブリックにアクセス可能なコンテナレジストリに保存しておきます。

### ホストの設定

コンテナからマウントするディレクトリを作成します。

```
mkdir /work/data
```

### IoT Edgeモジュールのデプロイ

1. Azure IoT Hubの左PaneのメニューでIoT Edgeをクリックします。

2. IoT Edgeデバイス一覧から対象のIoT Edgeデバイスを選択します。

3. デバイスの詳細画面上部の[モジュールの設定]をクリックします。

4. モジュールの追加画面のデプロイモジュールセクションの[+追加]をクリックし、プルダウンメニューから[IoT Edgeモジュール]を選択します。

5. IoT Edgeのカスタムモジュール画面で、パラメータを入力して[保存]をクリックします。

#### 名前
任意の名称。例）pictweb

#### イメージのURI
コンテナイメージのURI 例）akubicharm/pictweb

#### コンテナーの作成オプション
 ```
{
  "ExposedPorts": {
    "80/tcp": {}
  },
  "HostConfig": {
    "PortBindings": {
      "80/tcp": [
        {
          "HostPort": "80"
        }
      ]
    },
    "Binds": [
      "/work/data:/hostvolume"
    ]
  }
}
```

#### 環境変数
|変数名|値|
|---|---|
|UPLOAD_DIR|コンテナ内のディレクトリの絶対パス例）/hostvolume

6. モジュールの追加画面に戻ったら[次へ]をクリックします。

7. ルートの指定画面で[次へ]をクリックします。

8. デプロイの確認画面で[送信]をクリックします。
